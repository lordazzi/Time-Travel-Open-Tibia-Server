<?php# AUTHOR: RICARDO AZZI ## CREATED: 17/01/13 #require_once($_SERVER["DOCUMENT_ROOT"]."/plugins/config.php");$qtdd = get("?");$pagseguro_email = "ricardoazzi91@hotmail.com";$pagseguro_token = "E226D110789F495C9903F43EF7C09F23";/* CONSIDERANDO A SEGUINTE TABELA DE PREÇOS	- 10 pontos: R$ 10,00	- 25 pontos: R$ 25,00	- 50 pontos: R$ 45,00	- 100 pontos: R$ 85,00*///criando objetos$acc = new Account(@$_SESSION["account"]);$sql = new MySql("ttotsite");if ($qtdd == 0) {	echo("Impossível entrar no pagseguro: você não definiu a quantidade de pontos que deseja comprar!");	return FALSE;	exit;} else if (!$acc->isLogin()) {	echo("Impossível entrar no pagseguro: faça o seu login!");	return FALSE;	exit;// } else if (!$acc->isConfirmed()) {	// echo("Impossível entrar no pagseguro: você não confirmou seu e-mail (você recebeu um e-mail de confirmação de cadastro)!");	// return FALSE;	// exit;} else if ($acc->getTelefonePrefixo() == "" OR $acc->getTelefone() == "" OR $acc->getCep() == "" OR $acc->getLogradouro() == "" OR $acc->getBairro() == "" OR $acc->getCidade() == "" OR $acc->getEstado() == "") {	echo("Impossível entrar no pagseguro: você não cadastrou no site suas informações de endereço! Essas informações são enviadas para o pagseguro, sem elas é impossível continuar.");	return FALSE;	exit;}//quantidade de pontos comprados$qtd100 = 0;$qtd50 = 0;$qtd1 = 0;//100 pontosif ($qtdd >= 100) {	$qtd100 = floor($qtdd / 100);	$qtdd = $qtdd % 100;}//50 pontosif ($qtdd >= 50) {	$qtd50 = floor($qtdd / 50);	$qtdd = $qtdd % 50;}//pontos restantes$qtd1 = $qtdd;//forma de pagamento (paypal, pagseguro)if (@$style == "paypal") {	System::using("PayPal");	$transation = "PP";} else {	System::using("PagSeguro");		//compra com pagseguro	$pagseguro = new PagSeguroPaymentRequest();		//identificador de produtos comprados	$uid_qtd1 = 0;	$uid_qtd50 = 0;	$uid_qtd100 = 0;	$transation = "PS";		//compra de 50 pontos para baixo	if ($qtd1 <> 0) {		$pagseguro->addItem(			'0001', //Número de identificação do produto			"1 ponto VIP para Time Travel", //Nome do item			$qtd1, //Quantidade			1.00 //Valor 		);				$uid_qtd1 = $sql->Query("INSERT INTO accounts_pontos_history (idaccount, idponto, nrqtdd, txtplugin, dtcadastro) VALUES (".$acc->getAccountId().", 1, $qtd1, 'pagseguro', NOW())");		$transation .= "-$uid_qtd1";	} else {		$transation .= "-0";	}		//compra entre 50 e 100 pontos	if ($qtd50 <> 0) {		$pagseguro->addItem(			'0002', 			"50 pontos VIP para Time Travel", 			$qtd50, 			45.00 //Valor 		);				$uid_qtd50 = $sql->Query("INSERT INTO accounts_pontos_history (idaccount, idponto, nrqtdd, txtplugin, dtcadastro) VALUES (".$acc->getAccountId().", 2, $qtd50, 'pagseguro', NOW())");		$transation .= "-$uid_qtd50";	} else {		$transation .= "-0";	}		//compra de 100 pontos	if ($qtd100 <> 0) {		$pagseguro->addItem(			'0003', 			"100 pontos VIP para Time Travel", 			$qtd100, 			85.00 //Valor 		);				$uid_qtd100 = $sql->Query("INSERT INTO accounts_pontos_history (idaccount, idponto, nrqtdd, txtplugin, dtcadastro) VALUES (".$acc->getAccountId().", 3, $qtd100, 'pagseguro', NOW())");		$transation .= "-$uid_qtd100";	} else {		$transation .= "-0";	}	//adicionando variavel de transição	if ($uid_qtd1 <> 0) { $sql->Query("UPDATE accounts_pontos SET txttransacao='$transation' WHERE idcompra='$uid_qtd1'"); }	if ($uid_qtd50 <> 0) { $sql->Query("UPDATE accounts_pontos SET txttransacao='$transation' WHERE idcompra='$uid_qtd50'"); }	if ($uid_qtd100 <> 0) { $sql->Query("UPDATE accounts_pontos SET txttransacao='$transation' WHERE idcompra='$uid_qtd100'"); }		//configurando as coisas do pagseguro	$pagseguro->setSender(		$acc->getUserName(), //Nome do comprador  		$acc->getEmail(), //e-mail do comprador		$acc->getTelPrefixo(), //DDD		$acc->getTelefone() //telefone 	);		$pagseguro->setShippingAddress(  		$acc->getCep(), //CEP   		$acc->getLogr(), //Nome da rua		$acc->getNumero(), //número da casa		$acc->getCompl(), //complemento		$acc->getBairro(), //bairro		$acc->getCidade(), //cidade		$acc->getEstado(), //estado		'BRA' //país	);		$pagseguro->setCurrency("BRL"); //moeda	$pagseguro->setShippingType(3); //frete indefinido	$pagseguro->setReference($transation);//associação com o meu sistema		// fazendo a requisição a API do PagSeguro pra obter a URL de pagamento  	$url = $pagseguro->register(		new PagSeguroAccountCredentials(  			$pagseguro_email,			$pagseguro_token						)	);	header("location: $url");}?>